---
title: 显示收到的电子邮件数量
description: 创建一个工作流，自动统计并显示从每个联系人收到的电子邮件数量。
---

import { VimeoEmbed } from '/snippets/vimeo-embed.mdx';

<img src="/images/user-guide/workflows/workflow-number-of-emails-received.png" style={{width:'100%'}} />

## 概览

此工作流在每次收到新电子邮件时触发，并将该发件人发送的电子邮件总数更新到人员记录上的自定义字段。

## 先决条件

在设置此工作流之前，请在 **人员** 对象上创建一个自定义字段：

1. 进入 **设置 → 数据模型 → 人员**
2. 添加一个新的 **数字** 字段
3. 将其命名为 "从此人收到的电子邮件数量"

## 分步设置

<VimeoEmbed videoId="1148700336" title="视频演示" />

### 步骤 1：配置触发器

1. 转到 **工作流** 并创建一个新工作流
2. 选择 **记录已创建** 作为触发器
3. 选择 **消息参与者**（位于高级对象下）

<Note>
  消息参与者是消息 ID 与人员 ID 的组合，每条消息对应一个唯一记录。 这比直接在消息上跟踪更容易，因为我们可以访问 `handle` 字段，其中包含发件人（或收件人）的电子邮件地址。
</Note>

### 步骤 2：按角色筛选

1. 添加 **过滤** 操作
2. 设置条件：**角色** 等于 **FROM**

这可确保你只统计此人发送的消息，而不是发送给他们的消息。

### 步骤 3：搜索 handle 相同的所有消息参与者

1. 添加 **搜索记录** 操作
2. 选择 **消息参与者** 作为对象
3. 添加筛选条件：**Handle** 等于触发器中的 handle（发件人的电子邮件地址），并且 **Role** 等于 **FROM**
4. 将 **Limit** 从 1 提高到 **200**（最大值）

这样可以找到来自该电子邮件地址的所有消息，以获取总计数。

<Note>
  “搜索记录”操作最多只能返回 200 条记录。 但是，由于你只使用 `totalCount` 值（而不是单条记录），此步骤将返回该人发送的电子邮件总数。
</Note>

### 步骤 4：使用创建或更新记录操作更新人员记录

1. 添加 **创建或更新记录** 操作

<Warning>
  在此使用 **插入或更新记录**，而不是 **更新记录**。 这使你可以通过其电子邮件地址（`handle` 字段）来识别该人员，而不需要前一步的记录 ID。
</Warning>

2. 选择 **人员** 作为对象
3. 通过将其电子邮件与消息参与者中的 `handle` 匹配来找到该人员。
4. 将自定义的 "收到的电子邮件数量" 字段设置为 `{{searchRecords.totalCount}}`

“搜索记录”操作中的 `totalCount` 值表示从该人员收到的电子邮件总数。

## 相关内容

* [工作流操作](/l/zh/user-guide/workflows/capabilities/workflow-actions)
* [创建自定义字段](/l/zh/user-guide/data-model/how-tos/customize-your-data-model)
* [搜索记录操作](/l/zh/user-guide/workflows/capabilities/workflow-actions#search-records)
