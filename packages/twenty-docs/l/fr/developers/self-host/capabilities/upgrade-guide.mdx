---
title: Guide de mise √† niveau
---

## Consignes g√©n√©rales

**Assurez-vous toujours de sauvegarder votre base de donn√©es avant de commencer le processus de mise √† niveau** en ex√©cutant `docker exec -it {db_container_name_or_id} pg_dumpall -U {postgres_user} > databases_backup.sql`.

Pour restaurer la sauvegarde, ex√©cutez `cat databases_backup.sql | docker exec -i {db_container_name_or_id} psql -U {postgres_user}`.

Si vous avez utilis√© Docker Compose, suivez ces √©tapes :

1. Dans un terminal, sur l'h√¥te o√π Twenty est en cours d'ex√©cution, √©teignez Twenty: `docker compose down`

2. Mettez √† niveau la version en changeant la valeur `TAG` dans le fichier .env pr√®s de votre docker-compose. (Nous recommandons de consommer la version `major.minor` telle que `v0.53`)

3. Remettez Twenty en ligne avec `docker compose up -d`

Si vous souhaitez mettre √† niveau votre instance de quelques versions, par exemple de la v0.33.0 √† la v0.35.0, vous devez mettre √† niveau votre instance de mani√®re s√©quentielle, dans cet exemple de la v0.33.0 √† la v0.34.0, puis de la v0.34.0 √† la v0.35.0.

**Assurez-vous qu'apr√®s chaque version mise √† niveau, votre sauvegarde ne soit pas corrompue.**

## √âtapes de mise √† niveau sp√©cifiques √† la version

## v1.0

Bonjour Twenty v1.0 ! üéâ

## v0.60

### Am√©liorations des performances

Toutes les interactions avec l'API des m√©tadonn√©es ont √©t√© optimis√©es pour de meilleures performances, en particulier pour la manipulation des m√©tadonn√©es d'objets et les op√©rations de cr√©ation d'espaces de travail.

Nous avons remani√© notre strat√©gie de mise en cache pour privil√©gier les acc√®s cache plut√¥t que les requ√™tes de base de donn√©es lorsque c'est possible, am√©liorant ainsi significativement les performances des op√©rations de l'API des m√©tadonn√©es.

Si vous rencontrez des probl√®mes d'ex√©cution apr√®s la mise √† niveau, vous devrez peut-√™tre vider votre cache pour vous assurer qu'il est synchronis√© avec les derni√®res modifications. Ex√©cutez cette commande dans votre conteneur twenty-server :

```bash
yarn command:prod cache:flush
```

### v0.55

Mettez √† niveau votre instance Twenty pour utiliser l'image v0.55

Vous n'avez plus besoin de lancer de commande, la nouvelle image se chargera automatiquement de l'ex√©cution de toutes les migrations requises.

### Erreur `L'utilisateur n'a pas d'autorisation`

Si vous rencontrez des erreurs d'autorisation sur la plupart des requ√™tes apr√®s la mise √† niveau, vous devrez peut-√™tre vider votre cache pour recalculer les derni√®res autorisations.

Dans votre conteneur `twenty-server`, ex√©cutez :

```bash
yarn command:prod cache:flush
```

Ce probl√®me est sp√©cifique √† cette version de Twenty et ne devrait pas √™tre n√©cessaire pour les futures mises √† niveau.

### v0.54

Depuis la version `0.53`, aucune action manuelle n'est n√©cessaire.

#### Abandon du sch√©ma de m√©tadonn√©es

Nous avons fusionn√© le sch√©ma `metadata` dans celui de `core` pour simplifier la r√©cup√©ration de donn√©es de `TypeORM`.
Nous avons int√©gr√© l'√©tape de commande `migrate` dans la commande `upgrade`. Nous ne recommandons pas l'ex√©cution manuelle de `migrate` dans l'un de vos conteneurs serveur/travailleur.

### Depuis la v0.53

√Ä partir de `0.53`, la mise √† niveau est effectu√©e de mani√®re programmatique au sein du `DockerFile`, cela signifie que vous ne devez plus ex√©cuter de commande manuellement.

Assurez-vous de continuer √† mettre √† jour votre instance de mani√®re s√©quentielle, sans sauter de version majeure (par exemple, de `0.43.3` √† `0.44.0` est autoris√©, mais de `0.43.1` √† `0.45.0` ne l'est pas), sinon cela pourrait entra√Æner une d√©synchronisation de la version de l'espace de travail pouvant entra√Æner une erreur d'ex√©cution et des fonctionnalit√©s manquantes.

Pour v√©rifier si un espace de travail a √©t√© correctement migr√©, vous pouvez consulter sa version dans la base de donn√©es dans la table `core.workspace`.

Il doit toujours √™tre dans la plage de la version `major.minor` de votre instance Twenty actuelle, vous pouvez consulter la version de votre instance dans le panneau d'administration (√† l'adresse `/settings/admin-panel`, accessible si votre utilisateur a la propri√©t√© `canAccessFullAdminPanel` d√©finie comme vraie dans la base de donn√©es) ou en ex√©cutant `echo $APP_VERSION` dans votre conteneur `twenty-server`.

Pour corriger une version d'espace de travail d√©synchronis√©e, vous devrez effectuer une mise √† niveau √† partir de la version correspondante de Twenty en suivant le guide de mise √† niveau correspondant s√©quentiellement, et ainsi de suite jusqu'√† atteindre la version souhait√©e.

#### Suppression de `auditLog`

Nous avons supprim√© l'objet standard auditLog, ce qui signifie que la taille de votre sauvegarde pourrait √™tre consid√©rablement r√©duite apr√®s cette migration.

### v0.51 √† v0.52

Mettez √† jour votre instance Twenty pour utiliser l'image v0.52

```
yarn database:migrate:prod
yarn command:prod upgrade
```

#### J'ai un espace de travail bloqu√© dans la version entre `0.52.0` et `0.52.6`

Malheureusement, `0.52.0` et `0.52.6` ont √©t√© enti√®rement supprim√©s de dockerHub.
Vous devrez mettre √† jour manuellement la version de votre espace de travail √† `0.51.0` dans la base de donn√©es et mettre √† niveau en utilisant la version twenty `0.52.11` en suivant son guide de mise √† niveau juste au-dessus.

### v0.50 √† v0.51

Mettez √† jour votre instance Twenty pour utiliser l'image v0.51

```
yarn database:migrate:prod
yarn command:prod upgrade
```

### v0.44.0 √† v0.50.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.50.0

```
yarn database:migrate:prod
yarn command:prod upgrade
```

#### Mutation docker-compose.yml

Cette version inclut une mutation `docker-compose.yml` pour donner au service `worker` acc√®s au volume `server-local-data`.
Veuillez mettre √† jour votre `docker-compose.yml` local avec [docker-compose.yml v0.50.0](https://github.com/twentyhq/twenty/blob/v0.50.0/packages/twenty-docker/docker-compose.yml)

### v0.43.0 √† v0.44.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.44.0

```
yarn database:migrate:prod
yarn command:prod upgrade
```

### v0.42.0 √† v0.43.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.43.0

```
yarn database:migrate:prod
yarn command:prod upgrade
```

Dans cette version, nous avons √©galement chang√© pour l'image postgres:16 dans `docker-compose.yml`.

#### (Option 1) Migration de base de donn√©es

Conserver l'image postgres-spilo existante est correct, mais vous devrez geler la version dans votre docker-compose.yml √† 0.43.0.

#### (Option 2) Migration de base de donn√©es

Si vous souhaitez migrer votre base de donn√©es vers la nouvelle image postgres:16, suivez ces √©tapes :

1. Exportez votre base de donn√©es depuis l'ancien conteneur postgres-spilo

```
docker exec -it twenty-db-1 sh
pg_dump -U {YOUR_POSTGRES_USER} -d {YOUR_POSTGRES_DB} > databases_backup.sql
exit
docker cp twenty-db-1:/home/postgres/databases_backup.sql .
```

Assurez-vous que votre fichier de sauvegarde n'est pas vide.

2. Mettez √† jour votre docker-compose.yml pour utiliser l'image postgres:16 comme dans le fichier [docker-compose.yml](https://raw.githubusercontent.com/twentyhq/twenty/main/packages/twenty-docker/docker-compose.yml).

3. Restaurez la base de donn√©es vers le nouveau conteneur postgres:16

```
docker cp databases_backup.sql twenty-db-1:/databases_backup.sql
docker exec -it twenty-db-1 sh
psql -U {YOUR_POSTGRES_USER} -d {YOUR_POSTGRES_DB} -f databases_backup.sql
exit
```

### v0.41.0 √† v0.42.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.42.0

```
yarn database:migrate:prod
yarn command:prod upgrade-0.42
```

**Variables d'environnement**

* Supprim√© : `FRONT_PORT`, `FRONT_PROTOCOL`, `FRONT_DOMAIN`, `PORT`
* Ajout√© : `FRONTEND_URL`, `NODE_PORT`, `MAX_NUMBER_OF_WORKSPACES_DELETED_PER_EXECUTION`, `MESSAGING_PROVIDER_MICROSOFT_ENABLED`, `CALENDAR_PROVIDER_MICROSOFT_ENABLED`, `IS_MICROSOFT_SYNC_ENABLED`

### v0.40.0 √† v0.41.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.41.0

```
yarn database:migrate:prod
yarn command:prod upgrade-0.41
```

**Variables d'environnement**

* Supprim√© : `AUTH_MICROSOFT_TENANT_ID`

### v0.35.0 √† v0.40.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.40.0

```
yarn database:migrate:prod
yarn command:prod upgrade-0.40
```

**Variables d'environnement**

* Ajout√© : `IS_EMAIL_VERIFICATION_REQUIRED`, `EMAIL_VERIFICATION_TOKEN_EXPIRES_IN`, `WORKFLOW_EXEC_THROTTLE_LIMIT`, `WORKFLOW_EXEC_THROTTLE_TTL`

### v0.34.0 √† v0.35.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.35.0

```
yarn database:migrate:prod
yarn command:prod upgrade-0.35
```

La commande `yarn database:migrate:prod` appliquera les migrations √† la structure de la base de donn√©es (sch√©mas core et metadata)
La commande `yarn command:prod upgrade-0.35` s'occupe de la migration des donn√©es de tous les espaces de travail.

**Variables d'environnement**

* Nous avons remplac√© `ENABLE_DB_MIGRATIONS` par `DISABLE_DB_MIGRATIONS` (la valeur par d√©faut est d√©sormais `false`, vous n'avez probablement rien √† param√©trer)

### v0.33.0 √† v0.34.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.34.0

```
yarn database:migrate:prod
yarn command:prod upgrade-0.34
```

La commande `yarn database:migrate:prod` appliquera les migrations √† la structure de la base de donn√©es (sch√©mas core et metadata)
La commande `yarn command:prod upgrade-0.34` s'occupe de la migration des donn√©es de tous les espaces de travail.

**Variables d'environnement**

* Supprim√© : `FRONT_BASE_URL`
* Ajout√© : `FRONT_DOMAIN`, `FRONT_PROTOCOL`, `FRONT_PORT`

Nous avons mis √† jour notre m√©thode de gestion des URL frontend.
Vous pouvez maintenant d√©finir l'URL frontend en utilisant les variables `FRONT_DOMAIN`, `FRONT_PROTOCOL` et `FRONT_PORT`.
Si FRONT_DOMAIN n'est pas d√©fini, l'URL frontend reviendra √† `SERVER_URL`.

### v0.32.0 √† v0.33.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.33.0

```
yarn command:prod cache:flush
yarn database:migrate:prod
yarn command:prod upgrade-0.33
```

La commande `yarn command:prod cache:flush` videra le cache Redis.
La commande `yarn database:migrate:prod` appliquera les migrations √† la structure de la base de donn√©es (sch√©mas core et metadata)
La commande `yarn command:prod upgrade-0.33` s'occupe de la migration des donn√©es de tous les espaces de travail.

√Ä partir de cette version, l'image twenty-postgres pour la DB est devenue obsol√®te et twenty-postgres-spilo est utilis√© √† la place.
Si vous souhaitez continuer √† utiliser l'image twenty-postgres, remplacez simplement `twentycrm/twenty-postgres:${TAG}` par `twentycrm/twenty-postgres` dans docker-compose.yml.

### v0.31.0 √† v0.32.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.32.0

**Migration de sch√©ma et de donn√©es**

```
yarn database:migrate:prod
yarn command:prod upgrade-0.32
```

La commande `yarn database:migrate:prod` appliquera les migrations √† la structure de la base de donn√©es (sch√©mas core et metadata)
La commande `yarn command:prod upgrade-0.32` s'occupe de la migration des donn√©es de tous les espaces de travail.

**Variables d'environnement**

Nous avons mis √† jour notre m√©thode de gestion de la connexion Redis.

* Supprim√© : `REDIS_HOST`, `REDIS_PORT`, `REDIS_USERNAME`, `REDIS_PASSWORD`
* Ajout√© : `REDIS_URL`

Mettez √† jour votre fichier `.env` pour utiliser la nouvelle variable `REDIS_URL` au lieu des param√®tres de connexion Redis individuels.

Nous avons √©galement simplifi√© notre m√©thode de gestion des tokens JWT.

* Supprim√© : `ACCESS_TOKEN_SECRET`, `LOGIN_TOKEN_SECRET`, `REFRESH_TOKEN_SECRET`, `FILE_TOKEN_SECRET`
* Ajout√© : `APP_SECRET`

Mettez √† jour votre fichier `.env` pour utiliser la nouvelle variable `APP_SECRET` √† la place des secrets de tokens individuels (vous pouvez utiliser le m√™me secret qu'avant ou g√©n√©rer une nouvelle cha√Æne al√©atoire).

**Compte connect√©**

Si vous utilisez un compte connect√© pour synchroniser vos emails et calendriers Google, vous devrez activer l'API des personnes sur votre console d'administration Google.

### v0.30.0 √† v0.31.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.31.0

**Migration de sch√©ma et de donn√©es :**

```
yarn database:migrate:prod
yarn command:prod upgrade-0.31
```

La commande `yarn database:migrate:prod` appliquera les migrations √† la structure de la base de donn√©es (sch√©mas core et metadata)
La commande `yarn command:prod upgrade-0.31` s'occupe de la migration des donn√©es de tous les espaces de travail.

### v0.24.0 √† v0.30.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.30.0

**Changement significatif**:
Pour am√©liorer les performances, Twenty n√©cessite d√©sormais la configuration de cache redis. Nous avons mis √† jour notre [docker-compose.yml](https://raw.githubusercontent.com/twentyhq/twenty/main/packages/twenty-docker/docker-compose.yml) pour refl√©ter cela.
Assurez-vous de mettre √† jour votre configuration et vos variables d'environnement en cons√©quence :

```
REDIS_HOST={your-redis-host}
REDIS_PORT={your-redis-port}
CACHE_STORAGE_TYPE=redis
```

**Migration de sch√©ma et de donn√©es :**

```
yarn database:migrate:prod
yarn command:prod upgrade-0.30
```

La commande `yarn database:migrate:prod` appliquera les migrations √† la structure de la base de donn√©es (sch√©mas core et metadata)
La commande `yarn command:prod upgrade-0.30` s'occupe de la migration des donn√©es de tous les espaces de travail.

### v0.23.0 √† v0.24.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.24.0

Ex√©cutez les commandes suivantes :

```
yarn database:migrate:prod
yarn command:prod upgrade-0.24
```

La commande `yarn database:migrate:prod` appliquera les migrations √† la structure de la base de donn√©es (sch√©mas core et metadata)
La commande `yarn command:prod upgrade-0.24` s'occupe de la migration des donn√©es de tous les espaces de travail.

### v0.22.0 √† v0.23.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.23.0

Ex√©cutez les commandes suivantes :

```
yarn database:migrate:prod
yarn command:prod upgrade-0.23
```

La commande `yarn database:migrate:prod` appliquera les migrations √† la base de donn√©es.
La commande `yarn command:prod upgrade-0.23` s'occupe de la migration des donn√©es, y compris le transfert des activit√©s vers les t√¢ches/notes.

### v0.21.0 √† v0.22.0

Mettez √† jour votre instance Twenty pour utiliser l'image v0.22.0

Ex√©cutez les commandes suivantes :

```
yarn database:migrate:prod
yarn command:prod workspace:sync-metadata -f
yarn command:prod upgrade-0.22
```

La commande `yarn database:migrate:prod` appliquera les migrations √† la base de donn√©es.
La commande `yarn command:prod workspace:sync-metadata -f` synchronisera la d√©finition des objets standard avec les tables de m√©tadonn√©es et appliquera les migrations n√©cessaires aux espaces de travail existants.
La commande `yarn command:prod upgrade-0.22` appliquera des transformations de donn√©es sp√©cifiques pour s‚Äôadapter aux nouvelles `defaultRequestInstrumentationOptions` d‚Äôobjet.
