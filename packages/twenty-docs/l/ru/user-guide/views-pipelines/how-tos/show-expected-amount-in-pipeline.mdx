---
title: Show Expected Amount in Your Pipeline
description: Рассчитывайте и отображайте взвешенные значения сделок на основе вероятности по этапам.
---

«Ожидаемая сумма» — вычисляемое значение: **Сумма × Вероятность**. Это помогает прогнозировать выручку, взвешивая сделки по вероятности их закрытия.

<Tip>
  Это пример создания [Полей формул](/l/ru/user-guide/workflows/how-tos/crm-automations/formula-fields) с помощью рабочих процессов.
</Tip>

В этом руководстве показана настройка пользовательских полей и рабочих процессов, необходимых для расчета и отображения ожидаемых сумм в вашей воронке.

## Шаг 1: Создайте пользовательские поля

В объекте «Сделки» вам нужны два пользовательских поля.

### Создайте поле «Вероятность»

1. Перейдите в **Настройки → Модель данных → Сделки**
2. Нажмите **+ Добавить поле**
3. Настроить:
   * **Название**: Вероятность
   * **Тип**: Число
   * **Описание**: Вероятность в зависимости от этапа (0–100%)
4. Нажмите **Сохранить**

### Создайте поле «Ожидаемая сумма»

1. Нажмите **+ Добавить поле**
2. Настроить:
   * **Название**: Ожидаемая сумма
   * **Тип**: Валюта
   * **Описание**: Вычисляется: Сумма × Вероятность
3. Нажмите **Сохранить**

### Необязательно: сделайте поля доступными только для чтения для пользователей

Если вы не хотите, чтобы пользователи вручную редактировали эти вычисляемые поля:

1. Перейдите в **Настройки → Роли**
2. Выберите роль для настройки
3. Найдите объект «Сделки»
4. Установите поля **Вероятность** и **Ожидаемая сумма** как доступные только для чтения

Это гарантирует, что обновлять эти значения смогут только рабочие процессы.

## Шаг 2: Создайте рабочий процесс №1 — обновление вероятности при изменении этапа

Этот рабочий процесс автоматически устанавливает «Вероятность», когда сделка переходит на новый этап.

### Создайте рабочий процесс

1. Перейдите в **Рабочие процессы**
2. Нажмите **+ Новый рабочий процесс**
3. Назовите его "Обновление вероятности при изменении этапа"

### Настройте триггер

1. Добавьте триггер **Запись создана или обновлена**
2. Выберите **Сделки** в качестве объекта
3. Фильтр: поле **Этап** обновлено

### Добавьте ветки для каждого этапа

Создайте ветку для каждого этапа с его вероятностью:

| Этап                | Вероятность |
| ------------------- | ----------- |
| Новый               | 10%         |
| Проверенные         | 25%         |
| Встреча             | 40%         |
| Предложение         | 60%         |
| Переговоры          | 80%         |
| Закрыта — Выиграна  | 100%        |
| Закрыта — Проиграна | 0%          |

<Note>
  Чтобы создать новую ветку, щелкните правой кнопкой мыши на холсте рабочего процесса и нажмите **Новое действие**. Затем свяжите это действие с предыдущим узлом, перетащив стрелку от предыдущего узла к этому новому действию.
</Note>

Для каждого этапа:

1. Добавьте узел **Фильтр**: Этап = [название этапа]
2. Добавьте действие **Обновить запись**:
   * Запись: инициировавшая срабатывание сделка
   * Поле: Вероятность
   * Значение: [вероятность для этого этапа]

### Рассчитать «Ожидаемую сумму»

После объединения веток:

1. Добавьте узел **Фильтр**: поле Сумма не пусто
2. Добавьте действие **Обновить запись**:
   * Запись: инициировавшая срабатывание сделка
   * Поле: Ожидаемая сумма
   * Значение: Сумма × Вероятность

## Шаг 3: Создайте рабочий процесс №2 — пересчет при изменении суммы

Этот рабочий процесс обновляет «Ожидаемую сумму», когда изменяется «Сумма» сделки.

### Создайте рабочий процесс

1. Перейдите в **Рабочие процессы**
2. Нажмите **+ Новый рабочий процесс**
3. Назовите его "Пересчет «Ожидаемой суммы» при изменении «Суммы»"

### Настройте триггер

1. Добавьте триггер **Запись создана или обновлена**
2. Выберите **Сделки** в качестве объекта
3. Фильтр: поле **Сумма** обновлено

### Добавьте логику

1. Добавьте узел **Фильтр**: поле Сумма не пусто
2. Добавьте действие **Обновить запись**:
   * Запись: инициировавшая срабатывание сделка
   * Поле: Ожидаемая сумма
   * Значение: Сумма × Вероятность

## Шаг 4: Отображение в вашей воронке

Теперь покажите итоги по «Ожидаемой сумме» в вашем канбан-представлении:

1. Откройте канбан-представление **Воронка продаж**
2. Нажмите на **число** рядом с названием любого этапа в верхней части столбца
3. Выберите **Сумма**
4. Выберите **Ожидаемая сумма**

Теперь каждый столбец показывает общую взвешенную сумму воронки для этого этапа.

## Резюме

| Компонент                  | Назначение                                                                           |
| -------------------------- | ------------------------------------------------------------------------------------ |
| **Поле «Вероятность»**     | Хранит вероятность выигрыша в зависимости от этапа                                   |
| **Поле «Ожидаемая сумма»** | Хранит значение «Сумма × Вероятность»                                                |
| **Рабочий процесс №1**     | Обновляет «Вероятность» при изменении «Этапа», затем пересчитывает «Ожидаемую сумму» |
| **Рабочий процесс №2**     | Пересчитывает «Ожидаемую сумму» при изменении «Суммы»                                |
| **Агрегация**              | Отображает сумму поля «Ожидаемая сумма» по каждому этапу                             |

## Связанные материалы

* [Поля формул](/l/ru/user-guide/workflows/how-tos/crm-automations/formula-fields) — создавайте вычисляемые поля с помощью рабочих процессов
* [Канбан-представления](/l/ru/user-guide/views-pipelines/capabilities/kanban-views) — агрегации столбцов
* [Как создать пользовательские поля](/l/ru/user-guide/data-model/how-tos/create-custom-fields) — настройка полей
